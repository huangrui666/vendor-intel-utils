From c59508acd3a2ad262e5f52f65a864473176e0f20 Mon Sep 17 00:00:00 2001
From: Huang Rui <rui1.huang@intel.com>
Date: Fri, 12 May 2023 23:24:21 +0800
Subject: [PATCH] Enable tiled render buffer

Tracked-On: OAM-109806
Change-Id: Ic3dff413ed4d9ee0242574fd0139c1790b090766
Signed-off-by: Huang Rui <rui1.huang@intel.com>
---
 i915.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/i915.c b/i915.c
index cfea436..287ac01 100644
--- a/i915.c
+++ b/i915.c
@@ -248,11 +248,15 @@ static int i915_add_combinations(struct driver *drv)
 
 	scanout_and_render =
 	    unset_flags(scanout_and_render, BO_USE_SW_READ_RARELY | BO_USE_SW_WRITE_RARELY);
-
-	metadata.tiling = I915_TILING_Y;
-	metadata.priority = 3;
-	metadata.modifier = I915_FORMAT_MOD_Y_TILED;
-
+	if (i915_has_tile4(drv)) {
+		metadata.tiling = I915_TILING_4;
+		metadata.priority = 3;
+		metadata.modifier = I915_FORMAT_MOD_4_TILED;
+	} else {
+		metadata.tiling = I915_TILING_Y;
+		metadata.priority = 3;
+		metadata.modifier = I915_FORMAT_MOD_Y_TILED;
+	}
 	// dGPU do not support Tiling Y mode
 	if ((drv->gpu_grp_type == TWO_GPU_IGPU_DGPU) || (drv->gpu_grp_type == THREE_GPU_IGPU_VIRTIO_DGPU))
 		 scanout_and_render = unset_flags(scanout_and_render, BO_USE_SCANOUT);
-- 
2.25.1

